{% extends 'base.html' %}
{% load static %}

{% block title %}Мой профиль{% endblock %}

{% block content %}

<div class="container edit-profile-page">

    <!-- КНОПКА НАЗАД -->
    <a href="{% url 'movie_list' %}" class="back-link mb-3 d-inline-block">
        <i class="fas fa-arrow-left"></i> На главную
    </a>

    <!-- ПРОФИЛЬ -->
    <!-- 1. Компактная карточка -->
    <div class="profile-card">
        <div class="profile-card-left">
            <div class="avatar-circle">
                {% if profile.avatar %}
                    <img src="{{ profile.avatar.url }}" alt="">
                {% else %}
                    <span>{{ user.username|first|upper }}</span>
                {% endif %}
            </div>
            <div class="name-date">
                <h1>{{ user.username }}</h1>
                <p>участник с {{ user.date_joined|date:"d.m.Y" }}</p>
            </div>
        </div>

        <div class="profile-card-right">
            <div class="stat-mini"><span>{{ reviews|length }}</span><small>отзывов</small></div>
            <div class="stat-mini"><span>{{ reviews|length }}</span><small>фильмов</small></div>
            <div class="stat-mini"><span>{% if reviews %}✔{% else %}—{% endif %}</span><small>активность</small></div>
        </div>
    </div>

    <!-- 2. Описание / e-mail (если есть) -->
    {% if profile.bio or user.email %}
    <div class="profile-bio-mail">
        {% if profile.bio %}<p><i class="fas fa-quote-left me-2 text-warning"></i>{{ profile.bio }}</p>{% endif %}
        {% if user.email %}<p><i class="fas fa-envelope me-2"></i>{{ user.email }}</p>{% endif %}
    </div>
    {% endif %}

        <!-- МОИ ОТЗЫВЫ -->
    <div class="reviews-section" style="margin-top: 60px;">
        <h2>
            <i class="fas fa-comments"></i> Мои отзывы
        </h2>

        {% if reviews %}
            {% for review in reviews %}
                <div class="profile-review-card">

                    <div class="review-movie-info">
                        <div style="min-width: 60px;">
                            <div class="review-rating">
                                <i class="fas fa-star"></i>
                                <span>{{ review.rating }}</span>
                            </div>
                        </div>

                        <div class="review-content">
                            <div class="review-movie-title">
                                {{ review.movie.title }}
                            </div>

                            <div class="review-text">
                                {{ review.text|truncatechars:150 }}
                            </div>

                            <div style="color: #666; font-size: 0.8em; margin-top: 5px;">
                                {{ review.created_at|date:"d.m.Y H:i" }}
                            </div>
                        </div>
                    </div>

                    <div class="review-actions">
                        {% comment %}
                        <a href="{% url 'edit_review' review.movie.id %}"
                           class="btn"
                           style="padding: 8px 15px; font-size: 0.9em;">
                            <i class="fas fa-edit"></i> Изменить
                        </a>
                        {% endcomment %}
                        <a href="{% url 'movie_detail' review.movie.id %}"
                           class="btn"
                           style="padding: 8px 15px; font-size: 0.9em; background: rgba(72,219,251,0.2);">
                            <i class="fas fa-external-link-alt"></i> К фильму
                        </a>
                    </div>

                </div>
            {% endfor %}
        {% else %}
            <div class="empty-reviews">
                <i class="far fa-comment-dots"></i>
                <h3>Вы ещё не оставляли отзывов</h3>
                <p>Начните смотреть фильмы и делиться своим мнением!</p>

                <a href="{% url 'movie_list' %}"
                   class="btn btn-details"
                   style="margin-top: 20px;">
                    <i class="fas fa-film"></i> Смотреть фильмы
                </a>
            </div>
        {% endif %}
    </div>

    <!-- УПРАВЛЕНИЕ ПРОФИЛЕМ -->
    <div class="edit-profile-section"
         style="margin-top: 40px; padding-top: 30px; border-top: 1px solid rgba(255, 255, 255, 0.1);">

        <h2 style="color: #feca57; margin-bottom: 20px;">
            <i class="fas fa-cog me-2"></i> Управление профилем
        </h2>

        <div class="action-buttons"
             style="display: flex; gap: 15px; flex-wrap: wrap;">

            <a href="{% url 'edit_profile' %}"
               class="btn"
               style="background: linear-gradient(45deg, #48dbfb, #0abde3);
                      color: white; padding: 12px 25px;
                      border-radius: 10px;
                      text-decoration: none;
                      display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-user-edit"></i> Редактировать профиль
            </a>

            <a href="{% url 'change_password' %}"
               class="btn"
               style="background: linear-gradient(45deg, #feca57, #ff9f43);
                      color: white; padding: 12px 25px;
                      border-radius: 10px;
                      text-decoration: none;
                      display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-key"></i> Изменить пароль
            </a>

            <a href="{% url 'movie_list' %}"
               class="btn"
               style="background: rgba(255, 255, 255, 0.1);
                      color: #aaa; padding: 12px 25px;
                      border-radius: 10px;
                      text-decoration: none;
                      display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-home"></i> На главную
            </a>
        </div>
    </div>

</div>

{% endblock %}
