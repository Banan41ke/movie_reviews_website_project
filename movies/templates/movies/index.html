{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container">

<!-- HEADER -->
<header class="main-header">
    <div class="header-top">
        <h1><i class="fas fa-film"></i> Movie Reviews</h1>

        <div class="auth-buttons">
            {% if user.is_authenticated %}
                <form method="post" action="{% url 'logout' %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn-auth-link logout-btn">–í—ã–π—Ç–∏</button>
                </form>
            {% else %}
                <a href="{% url 'login' %}" class="btn-auth-link">–í–æ–π—Ç–∏</a>
                <a href="{% url 'register' %}" class="btn-auth-link">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
            {% endif %}

        </div>
    </div>

    <p class="tagline">–û—Ç–∫—Ä–æ–π—Ç–µ –¥–ª—è —Å–µ–±—è –ª—É—á—à–∏–µ —Ñ–∏–ª—å–º—ã –∏ –ø–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å–≤–æ–∏–º –º–Ω–µ–Ω–∏–µ–º</p>

    <form method="get" class="search-bar">
        <input
            type="text"
            name="search"
            placeholder="üîç –ü–æ–∏—Å–∫ —Ñ–∏–ª—å–º–æ–≤..."
            value="{{ search_query|default:'' }}"
        >
    </form>
</header>
<style>
    /* –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π –±–∞—Ä –≥–æ–¥–∞ */
.year-bar {
    background: rgba(255,255,255,.05);
    border: 1px solid rgba(255,255,255,.1);
    border-radius: 12px;
    padding: 10px 20px;
    margin: 0 auto 20px;
    max-width: 400px;
    display: flex;
    align-items: center;
    gap: 10px;
}
.year-form {
    display: flex;
    align-items: center;
    gap: 8px;
}
.year-form input {
    width: 90px;
    text-align: center;
}
.clear-year {
    color: #feca57;
    font-size: 1.2rem;
    text-decoration: none;
}
.clear-year:hover {
    color: #ff9800;
}
    .filter-sidebar {
    background: rgba(255,255,255,.05);
    border: 1px solid rgba(255,255,255,.1);
    border-radius: 12px;
    padding: 15px 20px;
    margin: 0 auto 20px;
    max-width: 420px;
}
.genre-radio {
    list-style: none;   /* ‚Üê —É–±–∏—Ä–∞–µ–º —Ç–æ—á–∫–∏ */
    padding: 0;
    margin: 0;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    flex-direction: column;
}
</style>

<!-- MAIN -->
<main class="main-layout">

    <!-- GENRES -->
    <!-- –ï–î–ò–ù–ê–Ø –§–û–†–ú–ê: –ì–æ–¥ + –ñ–∞–Ω—Ä -->
    <aside class="filter-sidebar">
        <form method="get" id="filterForm" class="filter-form">
            <!-- –ì–û–î -->
            <div class="filter-group">
                <label for="yearInput">–ì–æ–¥:</label>
                <input type="number"
                       id="yearInput"
                       name="year"
                       placeholder="2025"
                       min="1900"
                       max="2100"
                       value="{{ selected_year|default:'' }}"
                       onchange="this.form.submit()">
            </div>

            <!-- –ñ–ê–ù–†–´ (radio) -->
            <div class="filter-group">
                <label>–ñ–∞–Ω—Ä:</label>
                <ul class="genre-radio">
                    <li>
                        <label>
                            <input type="radio" name="genre" value=""
                                   {% if not selected_genre %}checked{% endif %}
                                   onchange="this.form.submit()">
                            –í—Å–µ –∂–∞–Ω—Ä—ã
                        </label>
                    </li>
                    {% for genre in genres %}
                    <li>
                        <label>
                            <input type="radio" name="genre" value="{{ genre.id }}"
                                   {% if selected_genre|stringformat:'s' == genre.id|stringformat:'s' %}checked{% endif %}
                                   onchange="this.form.submit()">
                            {{ genre.name }}
                        </label>
                    </li>
                    {% endfor %}
                </ul>
            </div>

            <!-- –ü–û–ò–°–ö (—Å–∫—Ä—ã—Ç–æ) -->
            <input type="hidden" name="search" value="{{ search_query|default:'' }}">

        </form>
    </aside>

    <!-- MOVIES -->
    <section class="movies-container">

        <div class="movies-header">
            <h2><i class="fas fa-fire"></i> –§–∏–ª—å–º—ã</h2>
            <span class="movies-count">{{ movies.count }} —Ñ–∏–ª—å–º–æ–≤</span>
        </div>

        {% if movies %}
        <div class="movie-grid">

            {% for movie in movies %}
            <a href="{% url 'movie_detail' movie.id %}" class="movie-card">



                <div class="poster-container">
                    {% if movie.poster %}
                        <img src="{{ movie.poster.url }}"
                             alt="{{ movie.title }}"
                             class="movie-poster">
                    {% else %}
                        <img src="https://via.placeholder.com/300x450?text={{ movie.title|urlencode }}"
                             class="movie-poster">
                    {% endif %}
                </div>

                <div class="movie-info">
                    <h3 class="movie-title">{{ movie.title }}</h3>

                    <div class="movie-meta">
                        <span><i class="far fa-calendar"></i> {{ movie.release_year }}</span>
                        {% if movie.duration %}
                            <span><i class="far fa-clock"></i> {{ movie.duration }} –º–∏–Ω</span>
                        {% endif %}
                    </div>

                    <p class="movie-description">
                        {{ movie.description|truncatechars:120 }}
                    </p>

                    <div class="card-action-btn">
                        <i class="fas fa-info-circle"></i> –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                    </div>
                </div>

            </a>
            {% endfor %}

        </div>
        {% else %}
            <div class="no-movies">
                <i class="fas fa-film fa-3x"></i>
                <p>–§–∏–ª—å–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
            </div>
        {% endif %}

    </section>

</main>

</div>
{% endblock %}
