{% extends 'base.html' %}
{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Reviews - –õ—É—á—à–∏–µ —Ñ–∏–ª—å–º—ã</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º */
        .rating-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(45deg, #feca57, #ff9f43);
            color: #000;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
            z-index: 2;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 5px;
            min-width: 60px;
            justify-content: center;
        }

        .movie-card {
            position: relative;
            text-decoration: none;
            display: block;
        }

        .movie-poster {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: 10px 10px 0 0;
        }

        .poster-container {
            position: relative;
            overflow: hidden;
            border-radius: 10px 10px 0 0;
        }

        .movie-info {
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0 0 10px 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-top: none;
            transition: all 0.3s ease;
        }

        .movie-card:hover .movie-info {
            background: rgba(255, 255, 255, 0.08);
            border-color: #feca57;
        }

        .movie-title {
            color: #fff;
            font-size: 1.2em;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .movie-meta {
            display: flex;
            gap: 15px;
            margin-bottom: 12px;
            color: #aaa;
            font-size: 0.9em;
        }

        .movie-description {
            color: #ccc;
            font-size: 0.95em;
            line-height: 1.5;
            margin-bottom: 15px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .card-action-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #feca57;
            font-weight: bold;
            font-size: 0.9em;
            transition: transform 0.2s ease;
        }

        .movie-card:hover .card-action-btn {
            transform: translateX(5px);
        }
    </style>
</head>
<body>
<div class="container">

<!-- HEADER -->
<header class="main-header">
    <div class="header-top">
        <h1><i class="fas fa-film"></i> MOVIE REVIEWS</h1>

        <div class="auth-buttons">
            {% if user.is_authenticated %}
                <span class="user-greeting">–ü—Ä–∏–≤–µ—Ç, {{ user.username }}!</span>
                <form method="post" action="{% url 'logout' %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn-auth-link logout-btn">–í—ã–π—Ç–∏</button>
                </form>
            {% else %}
                <a href="{% url 'login' %}" class="btn-auth-link">–í–æ–π—Ç–∏</a>
                <a href="{% url 'register' %}" class="btn-auth-link">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
            {% endif %}
        </div>
    </div>

    <p class="tagline">–û—Ç–∫—Ä–æ–π—Ç–µ –¥–ª—è —Å–µ–±—è –ª—É—á—à–∏–µ —Ñ–∏–ª—å–º—ã –∏ –ø–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å–≤–æ–∏–º –º–Ω–µ–Ω–∏–µ–º</p>

    <div class="search-bar">
        <input type="text" placeholder="üîç –ü–æ–∏—Å–∫ —Ñ–∏–ª—å–º–æ–≤..." id="searchInput">
    </div>
</header>

<!-- MAIN CONTENT -->
<main>
    <aside class="genres-sidebar">
    <h3><i class="fas fa-tags"></i> –ñ–∞–Ω—Ä—ã</h3>
    <ul class="genre-list">
        <!-- –í—Å–µ —Ñ–∏–ª—å–º—ã -->
        <li>
            <a href="{% url 'movie_list' %}" 
               class="{% if not selected_genre %}active{% endif %}">
                üé¨ –í—Å–µ —Ñ–∏–ª—å–º—ã
            </a>
        </li>
        
        <!-- –ñ–∞–Ω—Ä—ã –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö -->
        {% for genre in genres %}
            <li>
                <a href="?genre={{ genre.id }}" 
                   class="{% if selected_genre == genre.id|stringformat:'s' %}active{% endif %}">
                    {{ genre.name|title }}
                </a>
            </li>
        {% empty %}
            <li>–ù–µ—Ç –∂–∞–Ω—Ä–æ–≤</li>
        {% endfor %}
    </ul>
</aside>

    <div class="movies-container">
        <div class="movies-header">
            <h2><i class="fas fa-fire"></i> –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ñ–∏–ª—å–º—ã</h2>
            <span class="movies-count">{{ movies|length }} —Ñ–∏–ª—å–º–æ–≤</span>
        </div>

        <div class="movie-grid">
            {% for movie in movies %}
            <a href="{% url 'movie_detail' movie.id %}" class="movie-card">
                <!-- –¢–û–õ–¨–ö–û –±–µ–π–¥–∂ —Å —Ä–µ–π—Ç–∏–Ω–≥–æ–º, –±–µ–∑ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ—Ç–∑—ã–≤–æ–≤ -->
                <div class="rating-badge">
                    <i class="fas fa-star"></i> {{ movie.avg_rating|floatformat:1 }}
                </div>

                <div class="poster-container">
                    {% if movie.poster and movie.poster.url %}
                        <img src="{{ movie.poster.url }}" alt="{{ movie.title }}" class="movie-poster"
                             onerror="this.src='https://via.placeholder.com/300x450?text={{ movie.title|urlencode }}'">
                    {% else %}
                        <img src="https://via.placeholder.com/300x450?text={{ movie.title|urlencode }}"
                             alt="{{ movie.title }}" class="movie-poster">
                    {% endif %}
                </div>

                <div class="movie-info">
                    <h3 class="movie-title">{{ movie.title }}</h3>

                    <div class="movie-meta">
                        <span><i class="far fa-calendar"></i> {{ movie.release_year }}</span>
                        {% if movie.duration %}
                            <span><i class="far fa-clock"></i> {{ movie.duration }} –º–∏–Ω</span>
                        {% endif %}
                    </div>

                    <p class="movie-description">
                        {{ movie.description|truncatechars:120|default:"–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç." }}
                    </p>

                    <div class="card-action-btn">
                        <i class="fas fa-info-circle"></i> –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                    </div>
                </div>
            </a>
            {% empty %}
            <div class="no-movies">
                <i class="fas fa-film fa-3x"></i>
                <p>–§–∏–ª—å–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</p>
            </div>
            {% endfor %}
        </div>
    </div>
</main>

<!-- FOOTER -->
<footer>
    <div class="footer-links">
        <a href="#">–û –ø—Ä–æ–µ–∫—Ç–µ</a>
        <a href="#">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
        <a href="#">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
    </div>
    <p>¬© 2024 Movie Reviews</p>
</footer>

</div>

<script>
    function searchMovies() {
        const query = document.getElementById('searchInput').value.toLowerCase().trim();
        const cards = document.querySelectorAll('.movie-card');
        let visibleCount = 0;

        cards.forEach(card => {
            const title = card.querySelector('.movie-title').textContent.toLowerCase();
            if (query === '' || title.includes(query)) {
                card.style.display = 'block';
                visibleCount++;
            } else {
                card.style.display = 'none';
            }
        });

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ —Ñ–∏–ª—å–º–æ–≤
        const countElement = document.querySelector('.movies-count');
        if (countElement) {
            countElement.textContent = visibleCount + ' —Ñ–∏–ª—å–º–æ–≤';
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.addEventListener('input', searchMovies);
        }
        
    });
</script>

</body>
</html>